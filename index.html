<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giữ Chuỗi Thói Quen</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; background: #121212; color: white; }
        .hidden { display: none; }
        .button {
            padding: 12px 24px; 
            margin: 10px; 
            border: none; 
            border-radius: 10px; 
            font-size: 18px; 
            cursor: pointer; 
            transition: 0.3s;
        }
        .button:hover { opacity: 0.8; }
        .fire-effect { position: absolute; font-size: 30px; animation: fall 1s linear infinite; }
        @keyframes fall { 0% { transform: translateY(0); } 100% { transform: translateY(100vh); } }
        
        /* Màu sắc cho từng loại chuỗi */
        .habit { background: #ff9800; color: white; }
        .love { background: #e91e63; color: white; }
        .study { background: #3f51b5; color: white; }
        .fitness { background: #4caf50; color: white; }
        .creative { background: #9c27b0; color: white; }

    </style>
</head>
<body>
    <h1>🔥 GIỮ CHUỖI THÓI QUEN 🔥</h1>
    <button id="startButton" class="button habit">Giữ Chuỗi</button>

    <div id="habitSelection" class="hidden">
        <h2>Chọn loại chuỗi:</h2>
        <button class="habit-type button habit" data-type="habit">Thói Quen 🛠️</button>
        <button class="habit-type button love" data-type="love">Ngày Yêu ❤️</button>
        <button class="habit-type button study" data-type="study">Học Tập 📚</button>
        <button class="habit-type button fitness" data-type="fitness">Tập Thể Dục 🏋️</button>
        <button class="habit-type button creative" data-type="creative">Sáng Tạo 🎨</button>
    </div>

    <div id="dateSelection" class="hidden">
        <h2>Nhập thông tin:</h2>
        <input type="text" id="username" placeholder="Tên của bạn"><br>
        <input type="date" id="startDate"><br>
        <div id="partnerSection" class="hidden">
            <input type="text" id="partnerName" placeholder="Tên người yêu">
        </div>
        <button id="saveData" class="button habit">Ghi danh</button>
    </div>

    <div id="resultContainer" class="hidden">
        <h2 id="resultText"></h2>
        <button id="leaderboardBtn" class="button study">📊 Bảng Xếp Hạng</button>
        <button id="miniGameBtn" class="button creative">🎮 Mini-Game X2</button>
    </div>

    <div id="leaderboard" class="hidden">
        <h2>🏆 TOP 100 NGƯỜI GIỮ CHUỖI</h2>
        <ol id="leaderboardList"></ol>
    </div>

    <div id="miniGame" class="hidden">
        <h2 id="miniGameQuestion"></h2>
        <div id="miniGameChoices"></div>
    </div>

    <script>
        let selectedType = "";

        document.getElementById("startButton").addEventListener("click", () => {
            document.getElementById("habitSelection").classList.remove("hidden");
        });

        document.querySelectorAll(".habit-type").forEach(button => {
            button.addEventListener("click", function() {
                selectedType = this.dataset.type;
                document.getElementById("habitSelection").classList.add("hidden");
                document.getElementById("dateSelection").classList.remove("hidden");

                if (selectedType === "love") {
                    document.getElementById("partnerSection").classList.remove("hidden");
                } else {
                    document.getElementById("partnerSection").classList.add("hidden");
                }
            });
        });

        document.getElementById("saveData").addEventListener("click", function() {
            let username = document.getElementById("username").value.trim();
            let startDate = new Date(document.getElementById("startDate").value);
            let today = new Date();
            
            if (!username) {
                alert("Vui lòng nhập tên!");
                return;
            }
            
            if (localStorage.getItem(username)) {
                alert("Tên này đã được sử dụng!");
                return;
            }
            
            if (startDate > today) {
                alert("Không thể chọn ngày trong tương lai!");
                return;
            }

            let streakDays = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
            
            localStorage.setItem(username, JSON.stringify({
                days: streakDays,
                type: selectedType
            }));

            document.getElementById("resultText").innerText = `${username} đã giữ chuỗi được ${streakDays} ngày!`;
            document.getElementById("dateSelection").classList.add("hidden");
            document.getElementById("resultContainer").classList.remove("hidden");

            for (let i = 0; i < 20; i++) {
                createFireEffect();
            }
        });

        function createFireEffect() {
            let fire = document.createElement("div");
            fire.classList.add("fire-effect");
            fire.innerHTML = "🔥";
            fire.style.left = Math.random() * window.innerWidth + "px";
            fire.style.top = "0px";
            document.body.appendChild(fire);
            setTimeout(() => fire.remove(), 1000);
        }

        document.getElementById("leaderboardBtn").addEventListener("click", () => {
            document.getElementById("leaderboard").classList.remove("hidden");
            let leaderboardList = document.getElementById("leaderboardList");
            leaderboardList.innerHTML = "";

            let users = Object.keys(localStorage).map(user => ({
                name: user,
                days: JSON.parse(localStorage.getItem(user)).days
            })).sort((a, b) => b.days - a.days).slice(0, 100);

            users.forEach(user => {
                let li = document.createElement("li");
                li.textContent = `${user.name}: ${user.days} ngày`;
                leaderboardList.appendChild(li);
            });
        });

        document.getElementById("miniGameBtn").addEventListener("click", () => {
            document.getElementById("miniGame").classList.remove("hidden");

            let questions = [
                { question: "Mặt trời mọc hướng nào?", choices: ["Đông", "Tây", "Bắc", "Nam"], correct: 0 },
                { question: "Thủ đô của Nhật Bản là?", choices: ["Tokyo", "Seoul", "Bắc Kinh", "Bangkok"], correct: 0 },
                { question: "5 x 6 = ?", choices: ["30", "25", "35", "40"], correct: 0 }
            ];

            let q = questions[Math.floor(Math.random() * questions.length)];
            document.getElementById("miniGameQuestion").innerText = q.question;
            document.getElementById("miniGameChoices").innerHTML = "";

            q.choices.sort(() => Math.random() - 0.5).forEach((choice, index) => {
                let btn = document.createElement("button");
                btn.innerText = choice;
                btn.onclick = () => alert(index === q.correct ? "✅ Đúng! X2 Chuỗi!" : "❌ Sai rồi!");
                document.getElementById("miniGameChoices").appendChild(btn);
            });
        });
    </script>
</body>
</html>
